@page "/fetchdata"

<PageTitle>Weather forecast</PageTitle>

@using tcgct_mtg.Models
@using tcgct.Data.MTG
@inject tcgct_mtg.Services.MTGSetService mtgset

<h1>Weather forecast</h1>

@if (sets == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Shorthand</th>
                <th>Icon</th>
                <th>Search URI</th>
                <th>Set Type</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var set in sets)
            {
                <tr style="display:@set.Display;visibility:@set.Visibility">
                    <td>@set.Set.ID</td>
                    <td>@set.Set.Name</td>
                    <td>@set.Set.Shorthand</td>
                    <td>@set.Set.Icon</td>
                    <td>@set.Set.Search_Uri</td>
                    <td>@set.Set.Set_Type_id.Name</td>
                </tr>
            }
        </tbody>
    </table>
    <button class="btn btn-primary" @onclick="PreviousPage">Previous Page</button>
    <button class="btn btn-primary" @onclick="NextPage">Next Page</button>
    <h5>@(page)</h5>
}

@code {
    int page = 0;
    int perPage = 20;
    private List<ViewSet>? sets;

    void LoadPage()
    {
        for (int i = page * perPage; i < (page * perPage) + perPage; i++)
        {
            sets[i].FlipVisibility();
        }
    }

    protected override async Task OnInitializedAsync()
    {
        IEnumerable<MTGSet> _sets = await mtgset.GetAll();
        sets = _sets.Select(x => new ViewSet(x)).ToList();

        LoadPage();
    }

    //int pageCount = (records + recordsPerPage - 1) / recordsPerPage;
    void NextPage()
    {
        if (page + 1 > (sets.Count + perPage - 1) / perPage)
        {
            return;
        }
        LoadPage();
        page++;
        LoadPage();
    }

    void PreviousPage()
    {
        if(page - 1 < 0)
        {
            return;
        }
        LoadPage();
        page--;
        LoadPage();
    }
}
